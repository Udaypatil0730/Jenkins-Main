

#!/bin/bash

echo "🔄 Updating system..."
sudo dnf update -y

echo "☕ Installing Java (Amazon Corretto 17)..."
sudo dnf install java-17-amazon-corretto -y

echo "📦 Cleaning old Jenkins repo if any..."
sudo rm -f /etc/yum.repos.d/jenkins.repo
sudo rm -f /etc/pki/rpm-gpg/jenkins.io.key

echo "🔑 Adding Jenkins repo and GPG key..."
sudo curl --silent --location https://pkg.jenkins.io/redhat-stable/jenkins.repo | sudo tee /etc/yum.repos.d/jenkins.repo > /dev/null
sudo curl --silent --location https://pkg.jenkins.io/redhat-stable/jenkins.io-2023.key | sudo tee /etc/pki/rpm-gpg/jenkins.io.key > /dev/null
sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io-2023.key

echo "🧹 Cleaning cache..."
sudo dnf clean all

echo "🚀 Installing Jenkins..."
sudo dnf install jenkins -y

echo "🔧 Enabling and starting Jenkins service..."
sudo systemctl daemon-reexec
sudo systemctl enable jenkins
sudo systemctl start jenkins

echo "✅ Jenkins service status:"
sudo systemctl status jenkins

echo "🔐 Fetching initial admin password..."
sudo cat /var/lib/jenkins/secrets/initialAdminPassword

echo "🌐 Access Jenkins UI via: http://<your-ec2-public-ip>:8080"
echo "🔓 Use the password above to unlock Jenkins web UI."
