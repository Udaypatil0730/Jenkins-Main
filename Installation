

#!/bin/bash

echo "🔄 Updating system..."
sudo dnf update -y

echo "☕ Installing Java (Amazon Corretto 17)..."
sudo dnf install java-17-amazon-corretto -y

echo "📦 Cleaning old Jenkins repo if any..."
sudo rm -f /etc/yum.repos.d/jenkins.repo
sudo rm -f /etc/pki/rpm-gpg/jenkins.io.key

echo "🔑 Adding Jenkins repo and GPG key..."
sudo curl --silent --location https://pkg.jenkins.io/redhat-stable/jenkins.repo | sudo tee /etc/yum.repos.d/jenkins.repo > /dev/null
sudo curl --silent --location https://pkg.jenkins.io/redhat-stable/jenkins.io-2023.key | sudo tee /etc/pki/rpm-gpg/jenkins.io.key > /dev/null
sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io-2023.key

echo "🧹 Cleaning cache..."
sudo dnf clean all

echo "🚀 Installing Jenkins..."
sudo dnf install jenkins -y

echo "🔧 Enabling and starting Jenkins service..."
sudo systemctl daemon-reexec
sudo systemctl enable jenkins
sudo systemctl start jenkins

echo "✅ Jenkins service status:"
sudo systemctl status jenkins

echo "🔐 Fetching initial admin password..."
sudo cat /var/lib/jenkins/secrets/initialAdminPassword

echo "🌐 Access Jenkins UI via: http://<your-ec2-public-ip>:8080"
echo "🔓 Use the password above to unlock Jenkins web UI."


## Terraform install##

sudo dnf update -y
sudo dnf install -y yum-utils
sudo dnf install -y unzip curl

sudo dnf config-manager --add-repo https://rpm.releases.hashicorp.com/AmazonLinux/hashicorp.repo
sudo dnf install -y terraform
terraform -version

## Jenkins pipeline ##

MULTISTAGE JENKINS FILE

pipeline {
    agent any

    stages {
        stage('git checkout') {
            steps {
               git branch: 'main', url: 'https://github.com/Udaypatil0730/TerraformCICD.git' 
            }
        }
         stage('terraform init') {
            steps {
                sh 'terraform init'
            }
        }
         stage('terraform plan') {
            steps {
                sh 'terraform plan'
            }
        }
        stage('terraform apply') {
            steps {
                sh 'terraform apply -auto-approve'
            }
        }
        stage('terraform destroy') {
            steps {
                sh 'terraform destroy -auto-approve'
            }
        }
    }
}
###################################################
SINGLR STAGE

pipeline {
    agent any

    stages {
        stage('git checkout') {
            steps {
               git branch: 'main', url: 'https://github.com/Udaypatil0730/TerraformCICD.git' 
            }
        }
 stage('terraform process') {
            steps {
            sh 'terraform init'
            sh 'terraform plan'
            sh 'terraform apply'

            }
        }
    }
}
#############################################################################

Webhook
